<div class="login-wrapper">
  <div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">Establecer Nueva Contraseña</h1>
            <p class="auth-subtitle">
                Crea una nueva contraseña segura para tu cuenta.
            </p>
        </div>

        @if (token) {
        <form
        [formGroup]="resetPasswordForm"
        (ngSubmit)="onSubmit()"
        class="auth-form"
        >
        <div formGroupName="passwordGroup" class="password-group">
            <div
            class="form-field"
            >
            <label for="password" class="input-label">Nueva Contraseña</label>
            <div class="input-wrapper">
                <lucide-icon
                [img]="LockIcon"
                size="18"
                class="input-icon"
                aria-hidden="true"
                ></lucide-icon>
                <input
                id="password"
                [type]="passwordVisible ? 'text' : 'password'"
                formControlName="password"
                placeholder="Mínimo 8 caracteres"
                (focus)="showPasswordHints = true"
                (blur)="onPasswordBlur()"
                [class.error]="passwordGroup.get('password')?.invalid && passwordGroup.get('password')?.touched"
                />
                <button
                type="button"
                class="toggle-password"
                (click)="passwordVisible = !passwordVisible"
                aria-label="Mostrar/Ocultar contraseña"
                >
                <lucide-icon
                    [img]="passwordVisible ? EyeOffIcon : EyeIcon"
                    size="18"
                ></lucide-icon>
                </button>
            </div>

            @if (showPasswordHints) {
            <div class="password-hints-popup">
                <p [class.valid]="passwordValue.length >= 8">
                <lucide-icon
                    [img]="passwordValue.length >= 8 ? CheckIcon : XIcon"
                    size="14"
                ></lucide-icon>
                Al menos 8 caracteres
                </p>
                <p [class.valid]="hasLowerCase(passwordValue)">
                <lucide-icon
                    [img]="hasLowerCase(passwordValue) ? CheckIcon : XIcon"
                    size="14"
                ></lucide-icon>
                Una letra minúscula
                </p>
                <p [class.valid]="hasUpperCase(passwordValue)">
                <lucide-icon
                    [img]="hasUpperCase(passwordValue) ? CheckIcon : XIcon"
                    size="14"
                ></lucide-icon>
                Una letra mayúscula
                </p>
                <p [class.valid]="hasNumber(passwordValue)">
                <lucide-icon
                    [img]="hasNumber(passwordValue) ? CheckIcon : XIcon"
                    size="14"
                ></lucide-icon>
                Un número
                </p>
                <p [class.valid]="hasSpecialChar(passwordValue)">
                <lucide-icon
                    [img]="hasSpecialChar(passwordValue) ? CheckIcon : XIcon"
                    size="14"
                ></lucide-icon>
                Un símbolo
                </p>
            </div>
            }
            </div>

            <div
            class="form-field"
            >
            <label for="confirmPassword" class="input-label"
                >Confirmar Contraseña</label
            >
            <div class="input-wrapper">
                <lucide-icon
                [img]="LockIcon"
                size="18"
                class="input-icon"
                aria-hidden="true"
                ></lucide-icon>
                <input
                id="confirmPassword"
                [type]="confirmPasswordVisible ? 'text' : 'password'"
                formControlName="confirmPassword"
                placeholder="Confirma tu nueva contraseña"
                [class.error]="passwordGroup.hasError('passwordMismatch') || (passwordGroup.get('confirmPassword')?.invalid && passwordGroup.get('confirmPassword')?.touched)"
                />
                <button
                type="button"
                class="toggle-password"
                (click)="confirmPasswordVisible = !confirmPasswordVisible"
                aria-label="Mostrar/Ocultar contraseña"
                >
                <lucide-icon
                    [img]="confirmPasswordVisible ? EyeOffIcon : EyeIcon"
                    size="18"
                ></lucide-icon>
                </button>
            </div>
            @if (passwordGroup.hasError('passwordMismatch') &&
            passwordGroup.get('confirmPassword')?.touched) {
            <div class="error-message">
                <lucide-icon [img]="AlertCircleIcon" size="14"></lucide-icon>
                Las contraseñas no coinciden.
            </div>
            }
            </div>
        </div>

        @if (errorMessage) {
        <div class="error-message global-error" role="alert">
            <lucide-icon [img]="AlertCircleIcon" size="16" aria-hidden="true"></lucide-icon>
            <span>{{ errorMessage }}</span>
        </div>
        } @if (successMessage) {
        <div class="success-message global-success" role="alert">
            <lucide-icon [img]="CheckCircleIcon" size="16" aria-hidden="true"></lucide-icon>
            <span>{{ successMessage }}</span>
        </div>
        }

        <button
            type="submit"
            class="submit-button"
            [disabled]="isLoading || resetPasswordForm.invalid"
            [class.loading]="isLoading"
        >
            @if(isLoading){
            <span class="spinner" aria-hidden="true"></span>
            }
            <span>Guardar Contraseña</span>
        </button>
        </form>
        }

        @if(!token) {
        <div class="error-message global-error" role="alert">
        <lucide-icon [img]="AlertCircleIcon" size="16" aria-hidden="true"></lucide-icon>
        <span>{{ errorMessage }}</span>
        </div>
        }
    </div>
  </div>

  <footer class="main-footer">
    <div class="footer-content">
      <div class="footer-top">
        <div class="support-section">
          <p class="support-text">
            Questions? Call
            <a href="tel:+18492001043" class="support-link">+1 (849) 200-1043</a>
          </p>
        </div>
      </div>

      <nav class="footer-links">
        <a routerLink="/privacy">Privacidad</a>
        <a routerLink="/terms">Términos</a>
        <a routerLink="/cookies">Cookies</a>
      </nav>

      <div class="footer-bottom">
        <p class="copyright">
          &copy; 2023 Virteex. All rights reserved.
        </p>
      </div>
    </div>
  </footer>
</div>
