<div class="step-container" [formGroup]="parentForm">
    <div class="step-header">
        <h3>Localización y Fiscal</h3>
        <p>Datos requeridos para la facturación.</p>
    </div>

    <!-- Tax ID (Critical) -->
    <div class="form-row">
        <div class="form-field full-width"
            [class.error]="parentForm.get('taxId')?.invalid && (parentForm.get('taxId')?.touched || parentForm.get('taxId')?.dirty)">
            <label for="taxId">{{ countryService.currentCountry()?.formSchema?.taxId?.label || 'ID Fiscal / RNC' }}*</label>
            <div class="input-wrapper"><lucide-icon [img]="TaxIdIcon" size="18" class="input-icon"></lucide-icon><input
                    id="taxId" formControlName="taxId" [placeholder]="countryService.currentCountry()?.formSchema?.taxId?.placeholder || ''"></div>
            @if (parentForm.get('taxId')?.invalid && (parentForm.get('taxId')?.touched ||
            parentForm.get('taxId')?.dirty)) {
            <div class="error-message">
                @if (parentForm.get('taxId')?.errors?.['required']) { <span>{{ countryService.currentCountry()?.formSchema?.taxId?.label || 'ID Fiscal' }} es obligatorio</span> }
                @if (parentForm.get('taxId')?.errors?.['pattern']) { <span>{{ countryService.currentCountry()?.formSchema?.taxId?.errorMessage }}</span> }
                @if (parentForm.get('taxId')?.errors?.['serverError']) { <span>{{
                    parentForm.get('taxId')?.errors?.['serverError'] }}</span> }
            </div>
            }
        </div>
    </div>

    <!-- Company Phone -->
    <div class="form-row">
        <div class="form-field full-width"
            [class.error]="parentForm.get('companyPhone')?.invalid && (parentForm.get('companyPhone')?.touched || parentForm.get('companyPhone')?.dirty)">
            <label for="companyPhone">Teléfono de la Empresa*</label>
            <div class="input-wrapper"><lucide-icon [img]="PhoneIcon" size="18" class="input-icon"></lucide-icon><input
                    id="companyPhone" type="tel" formControlName="companyPhone" placeholder="809-555-5555"></div>
            @if (parentForm.get('companyPhone')?.invalid && (parentForm.get('companyPhone')?.touched ||
            parentForm.get('companyPhone')?.dirty)) {
            <div class="error-message">
                @if (parentForm.get('companyPhone')?.errors?.['required']) { <span>Teléfono es obligatorio</span> }
            </div>
            }
        </div>
    </div>

    <!-- Hidden / Read-only Country/Currency info display (Optional, good for UX to know where they are registering) -->
    <div class="info-banner">
        <div class="info-item">
            <lucide-icon [img]="CountryIcon" size="14"></lucide-icon>
            <span>País: <strong>{{ countryService.currentCountry()?.name }}</strong></span>
        </div>
        <div class="info-item">
            <lucide-icon [img]="CurrencyIcon" size="14"></lucide-icon>
            <span>Moneda: <strong>{{ countryService.currentCountry()?.currencyCode }}</strong></span>
        </div>
    </div>

</div>
